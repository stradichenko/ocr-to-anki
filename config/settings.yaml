# Configuration file: config/settings.yaml
# This file contains all settings for the OCR to Anki application

anki_connect:
  url: "http://localhost:8765"  # AnkiConnect server URL (default: http://localhost:8765)
  version: 6  # AnkiConnect API version (default: 6)
  timeout: 10  # Request timeout in seconds (default: 10)

import_defaults:
  deck: "Vocabulary::Japanese"  # Target Anki deck name (default: "Vocabulary::Japanese")
  model: "Basic"  # Anki note type/model (default: "Basic")
  batch_size: 10  # Number of cards to import at once (default: 10, range: 1-100)
  allow_duplicates: false  # Allow duplicate cards (options: true, false)
  duplicate_scope: "deck"  # Check duplicates in "deck" or "collection" (options: deck, collection)

logging:
  verbose: true  # Enable detailed logging output (options: true, false)
  show_progress: true  # Display progress indicators (options: true, false)

ocr:
  default_language: "eng"  # OCR language code (default: "eng", e.g., jpn, spa, fra)
  psm: 3  # Page segmentation mode (default: 3, range: 0-13)
  oem: 3  # OCR Engine mode (default: 3, range: 0-3)
  config: ""  # Additional Tesseract config options (default: empty string)
  
  # Input directory for images to process
  input_dir: "data/images"  # Source directory for input images (default: "data/images")
  output_dir: "data/processed_images"  # Directory for processed images (default: "data/processed")

image_preprocessing:
  # Grayscale conversion (reduces color noise)
  grayscale: true  # Convert to grayscale (options: true, false, default: true)
  
  # Contrast and brightness enhancement
  enhance_contrast: true  # Enable contrast enhancement (options: true, false, default: true)
  contrast: 1.8  # Contrast multiplier (default: 1.8, range: 0.5-3.0, 1.0 = no change)
  brightness: 0.05  # Brightness adjustment (default: 0.05, range: -1.0 to 1.0)
  
  # Noise reduction
  denoise: true  # Enable noise reduction (options: true, false, default: true)
  denoise_strength: "medium"  # Noise reduction level (options: light, medium, heavy, default: medium)
  
  # Sharpening (improves edge definition)
  sharpen: true  # Enable sharpening (options: true, false, default: true)
  sharpen_strength: 1.2  # Sharpening intensity (default: 1.2, range: 0.0-2.0)
  
  # Scaling (resize for optimal processing)
  scale: false  # Enable image scaling (options: true, false, default: true)
  scale_width: 2048  # Target width in pixels, maintains aspect ratio (default: 2048)
  
  # Rotation (deskew)
  rotate: false  # Enable manual rotation (options: true, false, default: false)
  rotation_degrees: 0  # Rotation angle in degrees (default: 0, negative = counter-clockwise)
  
  # Binarization (black and white only - use for high contrast docs)
  binarize: false  # Convert to pure black and white (options: true, false, default: false)
  threshold_value: 0.5  # Binarization threshold (default: 0.5, range: 0.0-1.0)
  
  # Output settings
  output_format: "png"  # Image format for processed files (options: png, jpg, tiff, default: png)
  output_quality: 2  # Compression quality (default: 2, range: 1-31 for JPEG/PNG, lower = better)

# AI Backend Selection
ai_backend:
  # Options: 'ollama', 'llama_cpp', 'vllm'
  type: 'llama_cpp'  # Change to 'llama_cpp' for fully offline mode

# llama.cpp Configuration (fully offline, no internet)
llama_cpp:
  host: '127.0.0.1'
  port: 8080
  context_size: 4096
  n_gpu_layers: -1  # -1 = use all GPU layers
  
  # Generation parameters
  temperature: 0.1
  max_tokens: 512
  top_k: 40
  top_p: 0.9
  repeat_penalty: 1.1
  stop_sequences: ["\n\n\n", "</s>", "---"]

gemma_enricher:
  model: "gemma3:1b"  # Ollama model to use for vocabulary enrichment (default: "gemma3:1b")
  url: "http://localhost:11434"  # Ollama server URL (default: http://localhost:11434)
  timeout: 60  # Request timeout in seconds (default: 60)
  
  # Language settings
  definition_language: "italian"  # Language for definitions (options: english, spanish, french, japanese, etc.)
  examples_language: "italian"  # Language for example phrases (options: english, spanish, french, japanese, etc.)
  
  # Processing settings
  batch_size: 5  # Number of words to process at once (default: 5)
  add_language_tags: true  # Auto-detect and add language tags (options: true, false, default: true)
  add_pos_tags: true  # Add part-of-speech tags (options: true, false, default: true)
  
  # Input/Output directories
  input_file: "data/vocabulary_input.json"  # Input JSON file with vocabulary (default: "data/vocabulary_input.json")
  output_dir: "data/enriched_vocabulary"  # Output directory for enriched vocabulary (default: "data/enriched_vocabulary")

highlight_detection:
  # Input/Output directories
  input_dir: "data/images"  # Source directory for input images (default: "data/images")
  output_dir: "data/cropped_highlights"  # Directory for cropped highlights (default: "data/cropped_highlights")
  
  # Color detection settings
  # Set individual colors to true/false to enable/disable detection
  colors_to_detect:
    yellow: false   # Yellow highlights
    orange: true    # Orange highlights (enable one at a time for testing)
    blue: false     # Blue highlights
    green: false    # Green highlights
    purple: false   # Purple/pink highlights
    red: false      # Red highlights
  
  # Adaptive detection settings
  adaptive_mode: false  # Start with non-adaptive mode for testing (options: true, false, default: true)
  color_tolerance: 25  # Reduced for less false positives (default: 20, range: 10-60)
  saturation_threshold: 0.3  # Higher threshold reduces false positives (default: 0.3, range: 0.1-0.8)
  value_threshold: 0.4  # Minimum brightness value (default: 0.4, range: 0.1-0.8)
  
  # Cropping settings
  min_area: 200  # Increased to filter out small false positives (default: 200)
  padding: 10  # Padding around cropped regions in pixels (default: 10)
  merge_nearby: true  # Merge nearby regions of same color (options: true, false, default: true)
  merge_distance: 25  # Maximum distance to merge regions in pixels (default: 30)
  
  # Output settings
  save_visualization: true  # Save debug images showing detected regions (options: true, false, default: true)
  output_format: "png"  # Output format for cropped images (options: png, jpg, default: png)
  organize_by_color: true  # Create subdirectories for each color (options: true, false, default: true)
